<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mood Music Player</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* Reset & body style */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #1e1e2f, #0f0f1a);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 30px;
      transition: background 1s ease;
    }

    h2 {
      font-size: 2em;
      margin-bottom: 20px;
      text-shadow: 0 0 10px rgba(255,255,255,0.5);
    }

    #moodContainer {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      width: 90%;
      max-width: 900px;
    }

    iframe {
      width: 100%;
      height: 450px;
      border-radius: 15px;
      box-shadow: 0 0 40px rgba(0,0,0,0.5);
      transition: all 0.5s ease;
    }

    /* Mood-based background colors */
    .happy { background: linear-gradient(135deg, #ff9a9e, #fad0c4); color: #111; }
    .sad { background: linear-gradient(135deg, #a1c4fd, #c2e9fb); color: #111; }
    .angry { background: linear-gradient(135deg, #f5576c, #ff9068); color: #111; }
    .relaxed { background: linear-gradient(135deg, #43e97b, #38f9d7); color: #111; }

    /* Footer */
    footer {
      margin-top: 40px;
      font-size: 0.9em;
      opacity: 0.7;
    }
  </style>
</head>
<body>
  <h2 id="status">Waiting for mood...</h2>
  <div id="moodContainer">
    <iframe id="musicPlayer" frameborder="0" allow="autoplay; encrypted-media"></iframe>
  </div>
  <footer>🎵 Mood Music Assistant</footer>

  <script>
    const status = document.getElementById("status");
    const musicPlayer = document.getElementById("musicPlayer");
    const body = document.body;

    // Connect to WebSocket server
    const ws = new WebSocket("ws://localhost:8765");

    ws.onopen = () => {
      status.innerText = "Connected to Mood Assistant ✅";
    };

    ws.onmessage = (event) => {
      const data = JSON.parse(event.data);
      const mood = data.mood;
      const url = data.url;

      status.innerText = `Mood detected: ${mood}`;

      // Change background based on mood
      body.className = "";
      switch (mood.toLowerCase()) {
        case "happy": body.classList.add("happy"); break;
        case "sad": body.classList.add("sad"); break;
        case "angry": body.classList.add("angry"); break;
        case "relaxed": body.classList.add("relaxed"); break;
        default: body.style.background = "#1e1e2f"; break;
      }

      // Auto-play music based on mood
      playMusicForMood(mood, url);
    };

    function playMusicForMood(mood, url) {
      // Mood-based music selection with better auto-play support
      const musicUrls = {
        "happy": "https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1&mute=0&loop=1&playlist=dQw4w9WgXcQ",
        "sad": "https://www.youtube.com/embed/9bZkp7q19f0?autoplay=1&mute=0&loop=1&playlist=9bZkp7q19f0", 
        "angry": "https://www.youtube.com/embed/kJQP7kiw5Fk?autoplay=1&mute=0&loop=1&playlist=kJQP7kiw5Fk",
        "relaxed": "https://www.youtube.com/embed/5qap5aO4i9A?autoplay=1&mute=0&loop=1&playlist=5qap5aO4i9A",
        "stressed": "https://www.youtube.com/embed/5qap5aO4i9A?autoplay=1&mute=0&loop=1&playlist=5qap5aO4i9A"
      };

      // Use provided URL or default based on mood
      let musicUrl;
      if (url && url.includes("youtube")) {
        const videoId = url.split("v=")[1]?.split("&")[0];
        musicUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=0&loop=1&playlist=${videoId}`;
      } else {
        musicUrl = musicUrls[mood.toLowerCase()] || musicUrls["relaxed"];
      }

      // Update the iframe source
      musicPlayer.src = musicUrl;
      
      // Also try to play programmatically
      setTimeout(() => {
        try {
          musicPlayer.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
        } catch (e) {
          console.log("Auto-play attempt failed, user interaction may be required");
        }
      }, 1000);
      
      console.log(`Playing music for mood: ${mood} - ${musicUrl}`);
      
      // Show notification
      showMoodNotification(mood);
    }

    function showMoodNotification(mood) {
      // Create a notification element
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        font-size: 18px;
        z-index: 1000;
        animation: slideIn 0.5s ease;
      `;
      notification.textContent = `🎵 Playing music for: ${mood.toUpperCase()}`;
      
      // Add animation
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideIn {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
      `;
      document.head.appendChild(style);
      
      document.body.appendChild(notification);
      
      // Remove after 3 seconds
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    ws.onclose = () => {
      status.innerText = "Disconnected from Mood Assistant ❌";
    };

    // Fallback: Test mood changes with buttons
    function addTestButtons() {
      const testContainer = document.createElement('div');
      testContainer.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 20px;
        display: flex;
        gap: 10px;
        z-index: 1000;
      `;
      
      const moods = ['happy', 'sad', 'angry', 'relaxed', 'stressed'];
      moods.forEach(mood => {
        const btn = document.createElement('button');
        btn.textContent = mood.toUpperCase();
        btn.style.cssText = `
          padding: 10px 15px;
          background: #007bff;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-weight: bold;
        `;
        btn.onclick = () => {
          console.log(`Testing mood: ${mood}`);
          playMusicForMood(mood, '');
        };
        testContainer.appendChild(btn);
      });
      
      document.body.appendChild(testContainer);
    }

    // Add test buttons after page loads
    setTimeout(addTestButtons, 2000);
  </script>
</body>
</html>
